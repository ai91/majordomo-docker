name: Build daily master

on:
  schedule:
    - cron: '0 4 * * *'

jobs:

  configure-params:
    uses: ai91/majordomo-docker/.github/workflows/build_configure_params.yml@main

  check-image-existence:
    name: Check existence of docker tag
    runs-on: ubuntu-latest
    needs: configure-params
    outputs:
      run_rest_jobs: ${{ steps.set_output.outputs.run_jobs }}
    steps:
      - name: Check
        shell: bash
        run: |
          docker manifest inspect ai91/majordomo-docker:${{ needs.configure-params.outputs.master_php7_tag }} > /dev/null 2>&1 && echo "::set-output name=run_jobs::false" || echo "::set-output name=run_jobs::true"

  trigger-build:
    name: Trigger build
    needs: [configure-params, check-image-existence]
    if: needs.check-image-existence.outputs.run_jobs == 'true'
    uses: ai91/majordomo-docker/.github/workflows/build_master.yml@main
    secrets: inherit

